require_relative 'api_runner'
module Unipept::Commands
  class Taxa2Tree < ApiRunner
    def initialize(args, opts, cmd)
      super

      @html_format = args[:html]

      # Overwrite the URL for this command, since it's possible that it uses HTML generated by the server.
      if @html_format
        options[:format] = "html"
        @url = "#{@host}/api/v1/#{cmd.name}.html"
      end


    end

    def handle_success_response(response, batch_id, fasta_mapper)
      result = response.response_body
      # We cannot filter and select fields if the format is HTML
      unless @html_format
        result = filter_result(result)
      end

      lambda do
        unless result.empty?
          output_writer.write_line formatter.header(result, fasta_mapper) if batch_id.zero? && !options[:"no-header"]
          output_writer.write_line formatter.format(result, fasta_mapper, batch_id.zero?)
        end
      end
    end

    def required_fields
      ['taxon_id']
    end

    def default_batch_size
      if options[:all]
        100
      else
        1000
      end
    end


  end
end

